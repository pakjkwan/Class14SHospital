<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hospital.web.mapper.Mapper" >
 	<resultMap id="Patient" type="com.hospital.web.domain.Patient">
        <id property="id" column="pat_id"/>
        <result property="nurID" column="nur_id"/>
        <result property="docID" column="doc_id"/>
        <result property="pass" column="pat_pass"/>
        <result property="name" column="pat_name"/>
        <result property="gen" column="pat_gen"/>
        <result property="jumin" column="pat_jumin"/>
        <result property="addr" column="pat_addr"/>
        <result property="phone" column="pat_phone"/>
        <result property="email" column="pat_email"/>
        <result property="job" column="pat_job"/>
    </resultMap>
  <select id="selectById" resultMap="Patient" parameterType="String">
    	SELECT * FROM Patient WHERE pat_id = #{id}
  </select>
  <select id="count" resultType="int">
    	SELECT COUNT(*) FROM Patient
  </select>
  <select id="exist" resultType="int" parameterType="String">
    	SELECT COUNT(*) FROM Patient WHERE pat_id=#{id}
  </select>
  <select id="find1" resultType="com.hospital.web.domain.Patient">
     
  		SELECT  
  			pat_id AS patID,
	    	nur_id AS nurID,
	    	doc_id AS docID,
	    	pat_pass AS patPass,
	    	pat_name AS patName,
	    	pat_gen AS patGen,
	    	pat_jumin AS patJumin,
	    	pat_addr AS patAddr,
	    	pat_phone AS patPhone,
	    	pat_email AS patEmail,
	    	pat_job AS patJob
  		FROM Patient WHERE id = ‘ACTIVE’
  
  <if test="title != null">
    	AND title like #{title}
  </if>
</select>
<select id="find2" resultType="com.hospital.web.domain.Patient">
     
  SELECT 
  			pat_id AS patID,
	    	nur_id AS nurID,
	    	doc_id AS docID,
	    	pat_pass AS patPass,
	    	pat_name AS patName,
	    	pat_gen AS patGen,
	    	pat_jumin AS patJumin,
	    	pat_addr AS patAddr,
	    	pat_phone AS patPhone,
	    	pat_email AS patEmail,
	    	pat_job AS patJob
   FROM Patient WHERE state = ‘ACTIVE’
  <if test="title != null">
    AND title like #{title}
  </if>
  <if test="author != null and author.name != null">
    AND author_name like #{author.name}
  </if>
</select>
 <select id="find3" resultType="com.hospital.web.domain.Patient">
     
  		SELECT 
  			pat_id AS patID,
	    	nur_id AS nurID,
	    	doc_id AS docID,
	    	pat_pass AS patPass,
	    	pat_name AS patName,
	    	pat_gen AS patGen,
	    	pat_jumin AS patJumin,
	    	pat_addr AS patAddr,
	    	pat_phone AS patPhone,
	    	pat_email AS patEmail,
	    	pat_job AS patJob
   		FROM Patient WHERE state = ‘ACTIVE’
  <choose>
    <when test="title != null">
      AND title like #{title}
    </when>
    <when test="author != null and author.name != null">
      AND author_name like #{author.name}
    </when>
    <otherwise>
      AND featured = 1
    </otherwise>
  </choose>
</select>
<select id="find4" resultType="com.hospital.web.domain.Patient">
     
  SELECT 
  			pat_id AS patID,
	    	nur_id AS nurID,
	    	doc_id AS docID,
	    	pat_pass AS patPass,
	    	pat_name AS patName,
	    	pat_gen AS patGen,
	    	pat_jumin AS patJumin,
	    	pat_addr AS patAddr,
	    	pat_phone AS patPhone,
	    	pat_email AS patEmail,
	    	pat_job AS patJob
   FROM Patient
  WHERE
  <if test="state != null">
    state = #{state}
  </if>
  <if test="title != null">
    AND title like #{title}
  </if>
  <if test="author != null and author.name != null">
    AND author_name like #{author.name}
  </if>
</select>
<select id="find5" resultType="com.hospital.web.domain.Patient">
     
  SELECT 
  			pat_id AS patID,
	    	nur_id AS nurID,
	    	doc_id AS docID,
	    	pat_pass AS patPass,
	    	pat_name AS patName,
	    	pat_gen AS patGen,
	    	pat_jumin AS patJumin,
	    	pat_addr AS patAddr,
	    	pat_phone AS patPhone,
	    	pat_email AS patEmail,
	    	pat_job AS patJob
   FROM Patient
  <where>
    <if test="state != null">
         state = #{state}
    </if>
    <if test="title != null">
        AND title like #{title}
    </if>
    <if test="author != null and author.name != null">
        AND author_name like #{author.name}
    </if>
  </where>
</select>
<update id="updateAuthorIfNecessary">
  update Patient
    <set>
      <if test="username != null">username=#{username},</if>
      <if test="password != null">password=#{password},</if>
      <if test="email != null">email=#{email},</if>
      <if test="bio != null">bio=#{bio}</if>
    </set>
  where id=#{id}
</update>
<select id="selectPostIn" resultType="com.hospital.web.domain.Patient">
  SELECT 
  			pat_id AS patID,
	    	nur_id AS nurID,
	    	doc_id AS docID,
	    	pat_pass AS patPass,
	    	pat_name AS patName,
	    	pat_gen AS patGen,
	    	pat_jumin AS patJumin,
	    	pat_addr AS patAddr,
	    	pat_phone AS patPhone,
	    	pat_email AS patEmail,
	    	pat_job AS patJob
  FROM POST P
  WHERE ID in
  <foreach item="item" index="index" collection="list"
      open="(" separator="," close=")">
        #{item}
  </foreach>
</select>
<select id="find7" resultType="com.hospital.web.domain.Patient">
  <bind name="pattern" value="'%' + _parameter.getTitle() + '%'" />
  SELECT 
  			pat_id AS patID,
	    	nur_id AS nurID,
	    	doc_id AS docID,
	    	pat_pass AS patPass,
	    	pat_name AS patName,
	    	pat_gen AS patGen,
	    	pat_jumin AS patJumin,
	    	pat_addr AS patAddr,
	    	pat_phone AS patPhone,
	    	pat_email AS patEmail,
	    	pat_job AS patJob
   FROM Patient
  WHERE title LIKE #{pattern}
</select>
<insert id="insert">
  <selectKey keyProperty="id" resultType="int" order="BEFORE">
    <if test="_databaseId == 'oracle'">
      select seq_users.nextval from dual
    </if>
    <if test="_databaseId == 'db2'">
      select nextval for seq_users from sysibm.sysdummy1"
    </if>
  </selectKey>
  insert into Patient values (#{id}, #{name})
</insert>
</mapper>


